# ──────────────────────────────────────────────────────────────────────────────
# PROJECT DIRECTORIES
# ──────────────────────────────────────────────────────────────────────────────

SRC_DIR       := src
INC_DIR       := includes
OBJDIR        := objs

# ──────────────────────────────────────────────────────────────────────────────
# PROJECT SETTINGS
# ──────────────────────────────────────────────────────────────────────────────

NAME          := philo
CC            := cc
CFLAGS        := -g -O0 -Wall -Wextra -Werror -I $(INC_DIR)
THREADS       := -pthread

# ──────────────────────────────────────────────────────────────────────────────
# SOURCE FILES
# ──────────────────────────────────────────────────────────────────────────────

SRCS          := \
	$(SRC_DIR)/dinner.c \
	$(SRC_DIR)/getters_setters.c \
	$(SRC_DIR)/input_parsing.c \
	$(SRC_DIR)/main.c \
	$(SRC_DIR)/monitor.c \
	$(SRC_DIR)/safe_functions.c \
	$(SRC_DIR)/utils.c \

# ──────────────────────────────────────────────────────────────────────────────
# OBJECT FILES
# ──────────────────────────────────────────────────────────────────────────────

OBJS          := $(SRCS:%.c=$(OBJDIR)/%.o)

# ──────────────────────────────────────────────────────────────────────────────
# DEFAULT TARGET
# ──────────────────────────────────────────────────────────────────────────────

all: $(NAME)

# ──────────────────────────────────────────────────────────────────────────────
# LINKING
# ──────────────────────────────────────────────────────────────────────────────

$(NAME): $(OBJS)
	@$(CC) $(CFLAGS) $(OBJS) -o $@ $(THREADS)

# ──────────────────────────────────────────────────────────────────────────────
# COMPILE RULE
# ──────────────────────────────────────────────────────────────────────────────

$(OBJDIR)/%.o: %.c
	@mkdir -p $(dir $@)
	@$(CC) $(CFLAGS) -c $< -o $@

# ──────────────────────────────────────────────────────────────────────────────
# CLEANUP
# ──────────────────────────────────────────────────────────────────────────────

clean:
	@rm -rf $(OBJDIR)

fclean: clean
	@rm -f $(NAME)

re: fclean all

.PHONY: all clean fclean re

leaks:
		@valgrind --leak-check=full --show-leak-kinds=all ./$(NAME)

qleaks:
		@valgrind -q --leak-check=full ./$(NAME)

hell:
		@valgrind --tool=helgrind ./$(NAME) 1 800 200 150

norm:
		@norminette | grep Error || true
