# ──────────────────────────────────────────────────────────────────────────────
# PROJECT DIRECTORIES
# ──────────────────────────────────────────────────────────────────────────────

SRC_DIR       := src
INC_DIR       := includes
OBJDIR        := objs

# ──────────────────────────────────────────────────────────────────────────────
# PROJECT SETTINGS
# ──────────────────────────────────────────────────────────────────────────────

NAME          := philo
CC            := cc
CFLAGS        := -Wall -Wextra -Werror -I $(INC_DIR)
THREADS       := -pthread

# ──────────────────────────────────────────────────────────────────────────────
# SOURCE FILES
# ──────────────────────────────────────────────────────────────────────────────

SRCS          := \
	$(SRC_DIR)/args.c \
	$(SRC_DIR)/init.c \
	$(SRC_DIR)/main.c \
	$(SRC_DIR)/routine.c \
	$(SRC_DIR)/monitor.c \
	$(SRC_DIR)/time.c \
	$(SRC_DIR)/print.c \
	$(SRC_DIR)/utils.c \
	$(SRC_DIR)/cleanup.c

# ──────────────────────────────────────────────────────────────────────────────
# OBJECT FILES
# ──────────────────────────────────────────────────────────────────────────────

OBJS          := $(SRCS:%.c=$(OBJDIR)/%.o)

# ──────────────────────────────────────────────────────────────────────────────
# DEFAULT TARGET
# ──────────────────────────────────────────────────────────────────────────────

all: $(NAME)

# ──────────────────────────────────────────────────────────────────────────────
# LINKING
# ──────────────────────────────────────────────────────────────────────────────

$(NAME): $(OBJS)
	@$(CC) $(CFLAGS) $(OBJS) -o $@ $(THREADS)

# ──────────────────────────────────────────────────────────────────────────────
# COMPILE RULE
# ──────────────────────────────────────────────────────────────────────────────

$(OBJDIR)/%.o: %.c
	@mkdir -p $(dir $@)
	@$(CC) $(CFLAGS) -c $< -o $@

# ──────────────────────────────────────────────────────────────────────────────
# CLEANUP
# ──────────────────────────────────────────────────────────────────────────────

clean:
	@rm -rf $(OBJDIR)

fclean: clean
	@rm -f $(NAME)

re: fclean all

.PHONY: all clean fclean re
